"use strict";(self.webpackChunk_minimal_kit_simple_cra_js=self.webpackChunk_minimal_kit_simple_cra_js||[]).push([[348],{70786:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(36314),r=n(4567),s=n(13838),l=n(52115),o=n(80184);function a(e){var t=e.open,n=e.onClose,a=e.onConfirm,c=e.title,d=void 0===c?"Delete Item?":c,u=e.description,m=void 0===u?"This action cannot be undone.":u;return(0,o.jsx)(l.Z,{open:t,onClose:n,arrow:"top-right",children:(0,o.jsxs)(i.Z,{spacing:2,sx:{p:2,minWidth:240},children:[(0,o.jsx)(r.Z,{variant:"subtitle1",children:d}),(0,o.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:m}),(0,o.jsxs)(i.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,o.jsx)(s.Z,{size:"small",onClick:n,children:"Cancel"}),(0,o.jsx)(s.Z,{size:"small",color:"error",variant:"contained",onClick:a,children:"Delete"})]})]})})}},1427:function(e,t,n){n.d(t,{Z:function(){return c}});var i=n(46128),r=n(697),s=n(4567),l=n(13400),o=n(29823),a=n(80184);function c(e){var t=e.open,n=e.onClose,c=e.title,d=e.children;return console.log("\ud83d\ude80 ~ MasterDrawer ~ title:",c),(0,a.jsx)(i.ZP,{anchor:"right",open:t,onClose:n,children:(0,a.jsxs)(r.Z,{sx:{width:{xs:300,sm:c.includes("Invoice")?1e3:600},p:3},children:[(0,a.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(s.Z,{variant:"h6",children:c}),(0,a.jsx)(l.Z,{onClick:n,children:(0,a.jsx)(o.Z,{})})]}),(0,a.jsx)(r.Z,{mt:3,children:d})]})})}},51348:function(e,t,n){n.r(t),n.d(t,{default:function(){return ee}});var i=n(6907),r=n(74165),s=n(93433),l=n(15861),o=n(29439),a=n(72791),c=n(81766),d=n(13092),u=n(89164),m=n(4567),x=n(36314),v=n(13838),h=n(27938),Z=n(13239),j=n(79836),f=n(56890),p=n(9195),g=n(68745),b=n(53382),y=n(13400),_=n(97892),I=n.n(_),C=n(38820),q=n(5397),S=n(99615),k=n(1427),w=n(70786),P=n(57088),D=n(1413),T=n(697),F=n(61889),N=n(68096),R=n(50168),A=n(65594),Q=n(82626),W=n(48550),O=n(61134),L=n(44695),H=n(8007),V=n(83027),z=n.n(V),E=n(27247),M=n(42419),X=n(71652),B=n(24750),K=n(65148),U=n(80184);I().extend(z());var $=H.Ry().shape({customerId:H.Z_().required("Customer is required"),sales_person:H.Z_().required("Sales person is required"),invoice_date:H.hT().required("Invoice date is required"),delivery_date:H.hT().required("Delivery date is required"),description:H.Z_().nullable(),items:H.IX().of(H.Ry().shape({item:H.Z_().required("Item is required"),quantity:H.Rx().required("Quantity is required").min(1,"Quantity must be at least 1").max(1e4,"Quantity too high"),rate:H.Rx().required("Rate is required").min(0,"Rate cannot be negative").max(1e6,"Rate too high"),tax:H.Rx().required("Tax is required").min(0,"Tax cannot be negative").max(100,"Tax must be less than or equal to 100"),total:H.Rx().required()})).min(1,"At least one item is required"),discount:H.Rx().min(0,"Discount cannot be negative").default(0)});function G(e){var t,n,i,r=e.onSubmit,s=e.onClose,l=e.initialData,o=e.customers,c=e.itemsList;console.log("\ud83d\ude80 ~ InvoiceForm ~ itemsList:",c),console.log("\ud83d\ude80 ~ InvoiceForm ~ customers:",o);var d=(0,O.cI)({resolver:(0,L.X)($),defaultValues:{customerId:null!==l&&void 0!==l&&l.customerId?l.customerId:"",sales_person:(null===l||void 0===l?void 0:l.sales_person)||"",invoice_date:(null===l||void 0===l?void 0:l.invoice_date)||I()().startOf("day").utc().toISOString(),delivery_date:(null===l||void 0===l?void 0:l.delivery_date)||I()().add(1,"day").startOf("day").utc().toISOString(),description:(null===l||void 0===l?void 0:l.description)||"",items:l.items?l.items:[{item:"",quantity:1,rate:0,tax:0,total:0}],discount:l?l.discount:0}}),u=d.control,x=d.register,Z=d.handleSubmit,_=d.watch,C=d.setValue,q=d.formState.errors,S=(0,O.Dq)({control:u,name:"items"}),k=S.fields,w=S.append,P=S.remove,H=_("items"),V=_("discount");console.log(_()),(0,a.useEffect)((function(){H.forEach((function(e,t){var n=(Number(e.quantity)||0)*(Number(e.rate)||0),i=n+(Number(e.tax)||0)/100*n;C("items.".concat(t,".total"),i)}))}),[H,V,C]);var z=H.reduce((function(e,t){return e+(t.total||0)}),0),G=z-V;return(0,a.useEffect)((function(){var e=_((function(e,t){var n=t.name;if(null!==n&&void 0!==n&&n.includes("items")&&n.endsWith(".item")){var i=parseInt(n.split(".")[1],10),r=c.find((function(t){return t._id===e.items[i].item}));if(r){var s=e.items[i].quantity||1,l=r.selling_price||0,o=r.tax||0,a=s*l,d=a+o/100*a;C("items.".concat(i,".rate"),l),C("items.".concat(i,".tax"),o),C("items.".concat(i,".total"),d)}}}));return function(){return e.unsubscribe()}}),[_,c,C]),(0,U.jsx)(T.Z,{component:"form",onSubmit:Z((function(e){var t=(0,D.Z)((0,D.Z)({},e),{},{subtotal:z,final_amount:G});r(t),s()})),noValidate:!0,children:(0,U.jsxs)(F.ZP,{container:!0,spacing:2,children:[(0,U.jsx)(F.ZP,{item:!0,xs:12,md:6,children:(0,U.jsxs)(N.Z,{fullWidth:!0,children:[(0,U.jsx)(R.Z,{id:"customer-select-label",children:"Select an Item"}),(0,U.jsx)(A.Z,(0,D.Z)((0,D.Z)({labelId:"customer-select-label",id:"customer-select",label:"Select Customer",error:!!q.customerId,value:_("customerId"),helperText:null===(t=q.customerId)||void 0===t?void 0:t.message},x("customerId")),{},{children:o.map((function(e){return(0,U.jsx)(Q.Z,{value:e._id,children:e.name},e._id)}))}))]})}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:6,children:(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({fullWidth:!0,label:"Sales Person",value:_("sales_person")},x("sales_person")),{},{error:!!q.sales_person,helperText:null===(n=q.sales_person)||void 0===n?void 0:n.message}))}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:6,children:(0,U.jsx)(X._,{dateAdapter:B.y,children:(0,U.jsx)(O.Qr,{name:"invoice_date",control:u,render:function(e){var t=e.field;return(0,U.jsx)(K.M,{label:"Invoice Date",value:t.value?I()(t.value):null,onChange:function(e){if(e){var n=e.startOf("day").utc().toISOString();t.onChange(n)}else t.onChange("")},slotProps:{textField:{fullWidth:!0}},renderInput:function(e){var t;return(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({},e),{},{error:!!q.invoice_date,helperText:null===(t=q.invoice_date)||void 0===t?void 0:t.message}))}})}})})}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:6,children:(0,U.jsx)(X._,{dateAdapter:B.y,children:(0,U.jsx)(O.Qr,{name:"delivery_date",control:u,render:function(e){var t=e.field;return(0,U.jsx)(K.M,{label:"Delivery Date",value:t.value?I()(t.value):null,onChange:function(e){return t.onChange(e?e.toISOString():"")},slotProps:{textField:{fullWidth:!0}},renderInput:function(e){var t;return(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({},e),{},{error:!!q.delivery_date,helperText:null===(t=q.delivery_date)||void 0===t?void 0:t.message}))}})}})})}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:12,children:(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({label:"Description"},x("description")),{},{value:_("description"),multiline:!0,rows:2,fullWidth:!0}))}),(0,U.jsxs)(F.ZP,{item:!0,xs:12,md:12,children:[(0,U.jsx)(m.Z,{variant:"h6",children:"Items"}),(0,U.jsx)(h.Z,{sx:{width:"100%",overflow:"auto",p:.5},children:(0,U.jsxs)(j.Z,{size:"small",children:[(0,U.jsx)(f.Z,{children:(0,U.jsxs)(p.Z,{children:[(0,U.jsx)(g.Z,{children:"Item"}),(0,U.jsx)(g.Z,{children:"Quantity"}),(0,U.jsx)(g.Z,{children:"Rate"}),(0,U.jsx)(g.Z,{children:"Tax %"}),(0,U.jsx)(g.Z,{children:"Total"}),(0,U.jsx)(g.Z,{align:"right",children:(0,U.jsx)(y.Z,{onClick:function(){return w({item:"",quantity:1,rate:0,tax:0,total:0})},children:(0,U.jsx)(M.Z,{})})})]})}),(0,U.jsx)(b.Z,{children:k.map((function(e,t){var n;return(0,U.jsxs)(p.Z,{children:[(0,U.jsx)(g.Z,{children:(0,U.jsx)(O.Qr,{control:u,name:"items.".concat(t,".item"),render:function(e){var n,i,r=e.field;return(0,U.jsxs)(N.Z,{style:{width:"200px"},children:[(0,U.jsx)(R.Z,{id:"item-simple-select-label",children:"Select an Item"}),(0,U.jsx)(A.Z,(0,D.Z)((0,D.Z)({labelId:"item-simple-select-label",id:"item-simple-select",label:"Select an Item",style:{width:"200px"}},r),{},{value:r.value||"",error:!(null===(n=q.items)||void 0===n||null===(i=n[t])||void 0===i||!i.item),children:c.map((function(e){return(0,U.jsx)(Q.Z,{value:e._id,children:e.item_name},e._id)}))}))]})}})}),(0,U.jsx)(g.Z,{children:(0,U.jsx)(O.Qr,{control:u,name:"items.".concat(t,".quantity"),render:function(e){var n,i,r,s,l,o=e.field;return(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({type:"number"},o),{},{onChange:function(e){var n=Number(e.target.value);C("items.".concat(t,".quantity"),n);var i=n*(Number(_("items.".concat(t,".rate")))||0),r=i+(Number(_("items.".concat(t,".tax")))||0)/100*i;C("items.".concat(t,".total"),r)},error:!(null===(n=q.items)||void 0===n||null===(i=n[t])||void 0===i||!i.quantity),helperText:null===(r=q.items)||void 0===r||null===(s=r[t])||void 0===s||null===(l=s.quantity)||void 0===l?void 0:l.message}))}})}),(0,U.jsx)(g.Z,{children:(0,U.jsx)(O.Qr,{control:u,name:"items.".concat(t,".rate"),render:function(e){var n,i,r,s,l,o=e.field;return(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({type:"number"},o),{},{onChange:function(e){var n=Number(e.target.value);C("items.".concat(t,".rate"),n);var i=(Number(_("items.".concat(t,".quantity")))||0)*n,r=i+(Number(_("items.".concat(t,".tax")))||0)/100*i;C("items.".concat(t,".total"),r)},error:!(null===(n=q.items)||void 0===n||null===(i=n[t])||void 0===i||!i.rate),helperText:null===(r=q.items)||void 0===r||null===(s=r[t])||void 0===s||null===(l=s.rate)||void 0===l?void 0:l.message}))}})}),(0,U.jsx)(g.Z,{children:(0,U.jsx)(O.Qr,{control:u,name:"items.".concat(t,".tax"),render:function(e){var n,i,r,s,l,o=e.field;return(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({type:"number"},o),{},{onChange:function(e){var n=Number(e.target.value);C("items.".concat(t,".tax"),n);var i=(Number(_("items.".concat(t,".quantity")))||0)*(Number(_("items.".concat(t,".rate")))||0),r=i+n/100*i;C("items.".concat(t,".total"),r)},error:!(null===(n=q.items)||void 0===n||null===(i=n[t])||void 0===i||!i.tax),helperText:null===(r=q.items)||void 0===r||null===(s=r[t])||void 0===s||null===(l=s.tax)||void 0===l?void 0:l.message}))}})}),(0,U.jsx)(g.Z,{children:(0,U.jsx)(W.Z,{value:((null===(n=H[t])||void 0===n?void 0:n.total)||0).toFixed(2),InputProps:{readOnly:!0},fullWidth:!0})}),(0,U.jsx)(g.Z,{align:"right",children:(0,U.jsx)(y.Z,{onClick:function(){1===H.length?(C("items.".concat(t,".item"),""),C("items.".concat(t,".quantity"),1),C("items.".concat(t,".rate"),0),C("items.".concat(t,".total"),0),C("items.".concat(t,".tax"),0)):P(t)},children:(0,U.jsx)(E.Z,{})})})]},e.id)}))})]})})]}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:12,display:"flex",flexDirection:"row",justifyContent:"flex-end",children:(0,U.jsx)(W.Z,(0,D.Z)((0,D.Z)({label:"Discount",type:"number"},x("discount")),{},{error:!!q.discount,helperText:null===(i=q.discount)||void 0===i?void 0:i.message,onBlur:function(){V&&0!==V&&""!==V||C("discount",0)}}))}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:12,children:(0,U.jsxs)(T.Z,{children:[(0,U.jsxs)(m.Z,{children:["Subtotal: \u20b9",z.toFixed(2)]}),(0,U.jsxs)(m.Z,{children:["Final Amount: \u20b9",G.toFixed(2)]})]})}),(0,U.jsx)(F.ZP,{item:!0,xs:12,md:12,children:(0,U.jsxs)(T.Z,{textAlign:"right",mt:2,children:[(0,U.jsx)(v.Z,{onClick:s,sx:{mr:1},children:"Cancel"}),(0,U.jsx)(v.Z,{type:"submit",variant:"contained",children:"Save"})]})})]})})}var J=function(e){return S.ZP.get(e).then((function(e){return e.data}))};function Y(){var e=(0,P.K$)(),t=(0,a.useState)(!1),n=(0,o.Z)(t,2),i=n[0],_=n[1],D=(0,a.useState)(null),T=(0,o.Z)(D,2),F=T[0],N=T[1];console.log("\ud83d\ude80 ~ InvoiceView ~ editInvoice:",F);var R=(0,a.useState)(null),A=(0,o.Z)(R,2),Q=A[0],W=A[1],O=(0,a.useState)(null),L=(0,o.Z)(O,2),H=L[0],V=L[1],z=(0,c.ZP)(S.Hv.invoice.list,J),E=z.data,M=z.error,X=z.isLoading,B=(0,c.ZP)(S.Hv.customer.list,J),K=B.data,$=(B.erro,B.isLoadig,(0,c.ZP)(S.Hv.items.list,J)),Y=$.data,ee=($.errr,$.isLading,function(){W(null),V(null)}),te=(0,a.useCallback)((function(){N(null),_(!0)}),[]),ne=(0,a.useCallback)(function(){var e=(0,l.Z)((0,r.Z)().mark((function e(t){var n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!F){e.next=9;break}return e.next=4,S.ZP.put("/invoice/update/".concat(F._id),t);case 4:n=e.sent,i=E.map((function(e){return e._id===F._id?n.data:e})),(0,d.j)(S.Hv.invoice.list,i,!1),e.next=13;break;case 9:return e.next=11,S.ZP.post("/invoice/add",t);case 11:n=e.sent,(0,d.j)(S.Hv.invoice.list,[].concat((0,s.Z)(E),[n.data]),!1);case 13:_(!1),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Failed to save invoice:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),[E,F]),ie=(0,a.useCallback)(function(){var e=(0,l.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.ZP.delete("/invoice/delete/".concat(t));case 3:(0,d.j)(S.Hv.invoice.list),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Failed to delete invoice:",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),[]);return M?(0,U.jsxs)(u.Z,{children:[(0,U.jsx)(m.Z,{variant:"h4",children:"Invoices"}),(0,U.jsx)("p",{style:{color:"red",paddingTop:100},children:"Failed to load invoices."})]}):(0,U.jsxs)(u.Z,{maxWidth:!e.themeStretch&&"xl",children:[(0,U.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",mb:3,children:[(0,U.jsx)(m.Z,{variant:"h4",children:"Invoices"}),(0,U.jsx)(v.Z,{variant:"contained",onClick:te,children:"Add Invoice"})]}),(0,U.jsx)(h.Z,{children:X?(0,U.jsx)(x.Z,{alignItems:"center",py:3,children:(0,U.jsx)(Z.Z,{})}):(0,U.jsxs)(j.Z,{children:[(0,U.jsx)(f.Z,{children:(0,U.jsxs)(p.Z,{children:[(0,U.jsx)(g.Z,{children:"Customer"}),(0,U.jsx)(g.Z,{children:"Sales Person"}),(0,U.jsx)(g.Z,{children:"Invoice Date"}),(0,U.jsx)(g.Z,{children:"Final Amount"}),(0,U.jsx)(g.Z,{align:"right",children:"Actions"})]})}),(0,U.jsx)(b.Z,{children:(null===E||void 0===E?void 0:E.length)>0?E.map((function(e){var t;return(0,U.jsxs)(p.Z,{children:[(0,U.jsx)(g.Z,{children:null===(t=e.customerId)||void 0===t?void 0:t.name}),(0,U.jsx)(g.Z,{children:e.sales_person}),(0,U.jsx)(g.Z,{children:new Date(e.invoice_date).toLocaleDateString()}),(0,U.jsxs)(g.Z,{children:["\u20b9",e.final_amount.toFixed(2)]}),(0,U.jsxs)(g.Z,{align:"right",children:[(0,U.jsx)(y.Z,{color:"primary",onClick:function(){var t={_id:e._id,customerId:e.customerId._id,sales_person:e.sales_person,invoice_date:I()(e.invoice_date),delivery_date:I()(e.delivery_date),description:e.description,items:e.items.map((function(e){return{item:e.item._id,quantity:e.quantity,rate:e.rate,tax:e.tax,total:e.total}})),discount:e.discount};N(t),_(!0)},children:(0,U.jsx)(C.Z,{})}),(0,U.jsx)(y.Z,{color:"error",onClick:function(t){return n=t,i=e._id,W(n.currentTarget),void V(i);var n,i},children:(0,U.jsx)(q.Z,{})})]})]},e._id)})):(0,U.jsx)(p.Z,{children:(0,U.jsx)(g.Z,{colSpan:5,align:"center",sx:{py:4},children:(0,U.jsx)(m.Z,{variant:"body1",children:"No invoices available."})})})})]})}),(0,U.jsx)(k.Z,{open:i,onClose:function(){return _(!1)},title:F?"Update Invoice":"Add Invoice",children:(0,U.jsx)(G,{initialData:F||{},onSubmit:ne,onClose:function(){return _(!1)},customers:K,itemsList:Y})}),(0,U.jsx)(w.Z,{open:Q,onClose:ee,onConfirm:function(){ie(H),ee()},title:"Delete Invoice?",description:"Are you sure you want to delete this invoice?"})]})}function ee(){return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(i.ql,{children:(0,U.jsx)("title",{children:" Dashboard: Three"})}),(0,U.jsx)(Y,{})]})}}}]);
//# sourceMappingURL=348.cc763706.chunk.js.map
"use strict";(self.webpackChunk_minimal_kit_simple_cra_js=self.webpackChunk_minimal_kit_simple_cra_js||[]).push([[348],{70786:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(36314),r=n(4567),s=n(13838),l=n(52115),o=n(80184);function a(e){var t=e.open,n=e.onClose,a=e.onConfirm,c=e.title,d=void 0===c?"Delete Item?":c,u=e.description,m=void 0===u?"This action cannot be undone.":u;return(0,o.jsx)(l.Z,{open:t,onClose:n,arrow:"top-right",children:(0,o.jsxs)(i.Z,{spacing:2,sx:{p:2,minWidth:240},children:[(0,o.jsx)(r.Z,{variant:"subtitle1",children:d}),(0,o.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:m}),(0,o.jsxs)(i.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,o.jsx)(s.Z,{size:"small",onClick:n,children:"Cancel"}),(0,o.jsx)(s.Z,{size:"small",color:"error",variant:"contained",onClick:a,children:"Delete"})]})]})})}},1427:function(e,t,n){n.d(t,{Z:function(){return c}});var i=n(46128),r=n(697),s=n(4567),l=n(13400),o=n(29823),a=n(80184);function c(e){var t=e.open,n=e.onClose,c=e.title,d=e.children;return(0,a.jsx)(i.ZP,{anchor:"right",open:t,onClose:n,children:(0,a.jsxs)(r.Z,{sx:{width:{xs:300,sm:c.includes("Invoice")?1e3:600},p:3},children:[(0,a.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(s.Z,{variant:"h6",children:c}),(0,a.jsx)(l.Z,{onClick:n,children:(0,a.jsx)(o.Z,{})})]}),(0,a.jsx)(r.Z,{mt:3,children:d})]})})}},32869:function(e,t,n){n.d(t,{Ds:function(){return i.Ds}});var i=n(84802);n(58764)},51348:function(e,t,n){n.r(t),n.d(t,{default:function(){return te}});var i=n(6907),r=n(74165),s=n(15861),l=n(29439),o=n(72791),a=n(81766),c=n(13092),d=n(89164),u=n(4567),m=n(36314),x=n(13838),v=n(48550),h=n(27938),Z=n(13239),j=n(79836),f=n(56890),p=n(9195),g=n(68745),y=n(53382),b=n(13400),_=n(52739),I=n(32869),C=n(97892),q=n.n(C),S=n(38820),w=n(5397),k=n(99615),P=n(1427),D=n(70786),T=n(57088),N=n(1413),F=n(697),R=n(61889),A=n(68096),Q=n(50168),W=n(65594),O=n(82626),L=n(61134),H=n(44695),z=n(8007),E=n(83027),V=n.n(E),M=n(27247),X=n(42419),B=n(71652),K=n(24750),U=n(65148),$=n(80184);q().extend(V());var G=z.Ry().shape({customerId:z.Z_().required("Customer is required"),sales_person:z.Z_().required("Sales person is required"),invoice_date:z.hT().required("Invoice date is required"),delivery_date:z.hT().required("Delivery date is required"),description:z.Z_().nullable(),items:z.IX().of(z.Ry().shape({item:z.Z_().required("Item is required"),quantity:z.Rx().required("Quantity is required").min(1,"Quantity must be at least 1").max(1e4,"Quantity too high"),rate:z.Rx().required("Rate is required").min(0,"Rate cannot be negative").max(1e6,"Rate too high"),tax:z.Rx().required("Tax is required").min(0,"Tax cannot be negative").max(100,"Tax must be less than or equal to 100"),total:z.Rx().required()})).min(1,"At least one item is required"),discount:z.Rx().min(0,"Discount cannot be negative").default(0)});function J(e){var t,n,i,r=e.onSubmit,s=e.onClose,l=e.initialData,a=e.customers,c=e.itemsList,d=(0,L.cI)({resolver:(0,H.X)(G),defaultValues:{customerId:null!==l&&void 0!==l&&l.customerId?l.customerId:"",sales_person:(null===l||void 0===l?void 0:l.sales_person)||"",invoice_date:(null===l||void 0===l?void 0:l.invoice_date)||q()().startOf("day").utc().toISOString(),delivery_date:(null===l||void 0===l?void 0:l.delivery_date)||q()().add(1,"day").startOf("day").utc().toISOString(),description:(null===l||void 0===l?void 0:l.description)||"",items:l.items?l.items:[{item:"",quantity:1,rate:0,tax:0,total:0}],discount:l?l.discount:0}}),m=d.control,Z=d.register,_=d.handleSubmit,I=d.watch,C=d.setValue,S=d.formState.errors,w=(0,L.Dq)({control:m,name:"items"}),k=w.fields,P=w.append,D=w.remove,T=I("items"),z=I("discount");(0,o.useEffect)((function(){T.forEach((function(e,t){var n=(Number(e.quantity)||0)*(Number(e.rate)||0),i=n+(Number(e.tax)||0)/100*n;C("items.".concat(t,".total"),i)}))}),[T,z,C]);var E=T.reduce((function(e,t){return e+(t.total||0)}),0),V=E-z;return(0,o.useEffect)((function(){var e=I((function(e,t){var n=t.name;if(null!==n&&void 0!==n&&n.includes("items")&&n.endsWith(".item")){var i=parseInt(n.split(".")[1],10),r=c.find((function(t){return t._id===e.items[i].item}));if(r){var s=e.items[i].quantity||1,l=r.selling_price||0,o=r.tax||0,a=s*l,d=a+o/100*a;C("items.".concat(i,".rate"),l),C("items.".concat(i,".tax"),o),C("items.".concat(i,".total"),d)}}}));return function(){return e.unsubscribe()}}),[I,c,C]),(0,$.jsx)(F.Z,{component:"form",onSubmit:_((function(e){var t=(0,N.Z)((0,N.Z)({},e),{},{subtotal:E,final_amount:V});r(t),s()})),noValidate:!0,children:(0,$.jsxs)(R.ZP,{container:!0,spacing:2,children:[(0,$.jsx)(R.ZP,{item:!0,xs:12,md:6,children:(0,$.jsxs)(A.Z,{fullWidth:!0,children:[(0,$.jsx)(Q.Z,{id:"customer-select-label",children:"Select Customer"}),(0,$.jsx)(W.Z,(0,N.Z)((0,N.Z)({labelId:"customer-select-label",id:"customer-select",label:"Select Customer",error:!!S.customerId,value:I("customerId"),helperText:null===(t=S.customerId)||void 0===t?void 0:t.message},Z("customerId")),{},{children:a.map((function(e){return(0,$.jsx)(O.Z,{value:e._id,children:e.name},e._id)}))}))]})}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:6,children:(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({fullWidth:!0,label:"Sales Person",value:I("sales_person")},Z("sales_person")),{},{error:!!S.sales_person,helperText:null===(n=S.sales_person)||void 0===n?void 0:n.message}))}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:6,children:(0,$.jsx)(B._,{dateAdapter:K.y,children:(0,$.jsx)(L.Qr,{name:"invoice_date",control:m,render:function(e){var t=e.field;return(0,$.jsx)(U.M,{label:"Invoice Date",value:t.value?q()(t.value):null,onChange:function(e){if(e){var n=e.startOf("day").utc().toISOString();t.onChange(n)}else t.onChange("")},slotProps:{textField:{fullWidth:!0}},renderInput:function(e){var t;return(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({},e),{},{error:!!S.invoice_date,helperText:null===(t=S.invoice_date)||void 0===t?void 0:t.message}))}})}})})}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:6,children:(0,$.jsx)(B._,{dateAdapter:K.y,children:(0,$.jsx)(L.Qr,{name:"delivery_date",control:m,render:function(e){var t=e.field;return(0,$.jsx)(U.M,{label:"Delivery Date",value:t.value?q()(t.value):null,onChange:function(e){return t.onChange(e?e.toISOString():"")},slotProps:{textField:{fullWidth:!0}},renderInput:function(e){var t;return(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({},e),{},{error:!!S.delivery_date,helperText:null===(t=S.delivery_date)||void 0===t?void 0:t.message}))}})}})})}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:12,children:(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({label:"Description"},Z("description")),{},{value:I("description"),multiline:!0,rows:2,fullWidth:!0}))}),(0,$.jsxs)(R.ZP,{item:!0,xs:12,md:12,children:[(0,$.jsx)(u.Z,{variant:"h6",children:"Items"}),(0,$.jsx)(h.Z,{sx:{width:"100%",overflow:"auto",p:.5},children:(0,$.jsxs)(j.Z,{size:"small",children:[(0,$.jsx)(f.Z,{children:(0,$.jsxs)(p.Z,{children:[(0,$.jsx)(g.Z,{children:"Item"}),(0,$.jsx)(g.Z,{children:"Quantity"}),(0,$.jsx)(g.Z,{children:"Rate"}),(0,$.jsx)(g.Z,{children:"Tax %"}),(0,$.jsx)(g.Z,{children:"Total"}),(0,$.jsx)(g.Z,{align:"right",children:(0,$.jsx)(b.Z,{onClick:function(){return P({item:"",quantity:1,rate:0,tax:0,total:0})},children:(0,$.jsx)(X.Z,{})})})]})}),(0,$.jsx)(y.Z,{children:k.map((function(e,t){var n;return(0,$.jsxs)(p.Z,{children:[(0,$.jsx)(g.Z,{children:(0,$.jsx)(L.Qr,{control:m,name:"items.".concat(t,".item"),render:function(e){var n,i,r=e.field;return(0,$.jsxs)(A.Z,{style:{width:"200px"},children:[(0,$.jsx)(Q.Z,{id:"item-simple-select-label",children:"Select an Item"}),(0,$.jsx)(W.Z,(0,N.Z)((0,N.Z)({labelId:"item-simple-select-label",id:"item-simple-select",label:"Select an Item",style:{width:"200px"}},r),{},{value:r.value||"",error:!(null===(n=S.items)||void 0===n||null===(i=n[t])||void 0===i||!i.item),children:c.map((function(e){return(0,$.jsx)(O.Z,{value:e._id,children:e.item_name},e._id)}))}))]})}})}),(0,$.jsx)(g.Z,{children:(0,$.jsx)(L.Qr,{control:m,name:"items.".concat(t,".quantity"),render:function(e){var n,i,r,s,l,o=e.field;return(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({type:"number"},o),{},{onChange:function(e){var n=Number(e.target.value);C("items.".concat(t,".quantity"),n);var i=n*(Number(I("items.".concat(t,".rate")))||0),r=i+(Number(I("items.".concat(t,".tax")))||0)/100*i;C("items.".concat(t,".total"),r)},error:!(null===(n=S.items)||void 0===n||null===(i=n[t])||void 0===i||!i.quantity),helperText:null===(r=S.items)||void 0===r||null===(s=r[t])||void 0===s||null===(l=s.quantity)||void 0===l?void 0:l.message}))}})}),(0,$.jsx)(g.Z,{children:(0,$.jsx)(L.Qr,{control:m,name:"items.".concat(t,".rate"),render:function(e){var n,i,r,s,l,o=e.field;return(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({type:"number"},o),{},{onChange:function(e){var n=Number(e.target.value);C("items.".concat(t,".rate"),n);var i=(Number(I("items.".concat(t,".quantity")))||0)*n,r=i+(Number(I("items.".concat(t,".tax")))||0)/100*i;C("items.".concat(t,".total"),r)},error:!(null===(n=S.items)||void 0===n||null===(i=n[t])||void 0===i||!i.rate),helperText:null===(r=S.items)||void 0===r||null===(s=r[t])||void 0===s||null===(l=s.rate)||void 0===l?void 0:l.message}))}})}),(0,$.jsx)(g.Z,{children:(0,$.jsx)(L.Qr,{control:m,name:"items.".concat(t,".tax"),render:function(e){var n,i,r,s,l,o=e.field;return(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({type:"number"},o),{},{onChange:function(e){var n=Number(e.target.value);C("items.".concat(t,".tax"),n);var i=(Number(I("items.".concat(t,".quantity")))||0)*(Number(I("items.".concat(t,".rate")))||0),r=i+n/100*i;C("items.".concat(t,".total"),r)},error:!(null===(n=S.items)||void 0===n||null===(i=n[t])||void 0===i||!i.tax),helperText:null===(r=S.items)||void 0===r||null===(s=r[t])||void 0===s||null===(l=s.tax)||void 0===l?void 0:l.message}))}})}),(0,$.jsx)(g.Z,{children:(0,$.jsx)(v.Z,{value:((null===(n=T[t])||void 0===n?void 0:n.total)||0).toFixed(2),InputProps:{readOnly:!0},fullWidth:!0})}),(0,$.jsx)(g.Z,{align:"right",children:(0,$.jsx)(b.Z,{onClick:function(){1===T.length?(C("items.".concat(t,".item"),""),C("items.".concat(t,".quantity"),1),C("items.".concat(t,".rate"),0),C("items.".concat(t,".total"),0),C("items.".concat(t,".tax"),0)):D(t)},children:(0,$.jsx)(M.Z,{})})})]},e.id)}))})]})})]}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:12,display:"flex",flexDirection:"row",justifyContent:"flex-end",children:(0,$.jsx)(v.Z,(0,N.Z)((0,N.Z)({label:"Discount",type:"number"},Z("discount")),{},{error:!!S.discount,helperText:null===(i=S.discount)||void 0===i?void 0:i.message,onBlur:function(){z&&0!==z&&""!==z||C("discount",0)}}))}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:12,children:(0,$.jsxs)(F.Z,{children:[(0,$.jsxs)(u.Z,{children:["Subtotal: \u20b9",E.toFixed(2)]}),(0,$.jsxs)(u.Z,{children:["Final Amount: \u20b9",V.toFixed(2)]})]})}),(0,$.jsx)(R.ZP,{item:!0,xs:12,md:12,children:(0,$.jsxs)(F.Z,{textAlign:"right",mt:2,children:[(0,$.jsx)(x.Z,{variant:"outlined",onClick:s,sx:{mr:1},children:"Cancel"}),(0,$.jsx)(x.Z,{type:"submit",color:"primary",variant:"contained",children:"Save"})]})})]})})}var Y=function(e){return k.ZP.get(e).then((function(e){return e.data}))};function ee(){var e=(0,T.K$)(),t=(0,o.useState)(!1),n=(0,l.Z)(t,2),i=n[0],C=n[1],N=(0,o.useState)(null),F=(0,l.Z)(N,2),R=F[0],A=F[1],Q=(0,o.useState)(null),W=(0,l.Z)(Q,2),O=W[0],L=W[1],H=(0,o.useState)(null),z=(0,l.Z)(H,2),E=z[0],V=z[1],M=(0,I.Ds)().enqueueSnackbar,X=(0,o.useState)(""),B=(0,l.Z)(X,2),K=B[0],U=B[1],G=(0,o.useState)(!1),ee=(0,l.Z)(G,2),te=ee[0],ne=ee[1],ie=(0,a.ZP)(k.Hv.invoice.list,Y),re=ie.data,se=ie.error,le=ie.isLoading,oe=(0,a.ZP)(k.Hv.customer.list,Y).data,ae=(0,a.ZP)(k.Hv.items.list,Y).data,ce=function(){L(null),V(null)},de=(0,o.useCallback)((function(){A(null),C(!0)}),[]),ue=(0,o.useCallback)(function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){var n,i,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne(!0),e.prev=1,!R){e.next=10;break}return e.next=5,k.ZP.put("/invoice/update/".concat(R._id),t);case 5:n=e.sent,(0,c.j)(k.Hv.invoice.list),200===(null===(i=n)||void 0===i?void 0:i.status)&&M("Invoice updated successfully.",{variant:"success"}),e.next=15;break;case 10:return e.next=12,k.ZP.post("/invoice/add",t);case 12:n=e.sent,(0,c.j)(k.Hv.invoice.list),201===(null===(s=n)||void 0===s?void 0:s.status)&&M("Invoice added successfully.",{variant:"success"});case 15:C(!1),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),console.error("Failed to save invoice:",e.t0),M(e.t0.message||"Something went wrong!",{variant:"error"});case 22:return e.prev=22,ne(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[1,18,22,25]])})));return function(t){return e.apply(this,arguments)}}(),[R,M]),me=(0,o.useCallback)(function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ne(!0),e.prev=1,e.next=4,k.ZP.delete("/invoice/delete/".concat(t));case 4:(0,c.j)(k.Hv.invoice.list),M("Invoice deleted successfully.",{variant:"success"}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("Failed to delete customer:",e.t0),M(e.t0.message||"Something went wrong!",{variant:"error"});case 12:return e.prev=12,ne(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})));return function(t){return e.apply(this,arguments)}}(),[M]);if(se)return(0,$.jsxs)(d.Z,{children:[(0,$.jsx)(u.Z,{variant:"h4",children:"Invoices"}),(0,$.jsx)("p",{style:{color:"red",paddingTop:100},children:"Failed to load invoices."})]});var xe=(null===re||void 0===re?void 0:re.filter((function(e){var t,n,i,r,s=K.toLowerCase(),l=(null===(t=e.customerId)||void 0===t||null===(n=t.name)||void 0===n?void 0:n.toLowerCase())||"",o=(null===(i=e.sales_person)||void 0===i?void 0:i.toLowerCase())||"",a=(null===(r=e.final_amount)||void 0===r?void 0:r.toString())||"";return l.includes(s)||o.includes(s)||a.includes(K)})))||[];return(0,$.jsxs)(d.Z,{maxWidth:!e.themeStretch&&"xl",children:[(0,$.jsxs)(m.Z,{direction:"row",justifyContent:"space-between",mb:3,children:[(0,$.jsx)(u.Z,{variant:"h4",children:"Invoices"}),(0,$.jsx)(x.Z,{variant:"contained",color:"primary",onClick:de,children:"Add Invoice"})]}),(0,$.jsx)("div",{children:(0,$.jsx)(v.Z,{fullWidth:!0,variant:"outlined",placeholder:"Search by customer name, sales person name",value:K,onChange:function(e){return U(e.target.value)},sx:{mb:3}})}),(0,$.jsx)(h.Z,{children:le?(0,$.jsx)(m.Z,{alignItems:"center",py:3,children:(0,$.jsx)(Z.Z,{})}):(0,$.jsxs)(j.Z,{children:[(0,$.jsx)(f.Z,{children:(0,$.jsxs)(p.Z,{children:[(0,$.jsx)(g.Z,{children:"Customer"}),(0,$.jsx)(g.Z,{children:"Sales Person"}),(0,$.jsx)(g.Z,{children:"Invoice Date"}),(0,$.jsx)(g.Z,{children:"Final Amount"}),(0,$.jsx)(g.Z,{align:"right",children:"Actions"})]})}),(0,$.jsx)(y.Z,{children:(null===xe||void 0===xe?void 0:xe.length)>0?xe.map((function(e){var t;return(0,$.jsxs)(p.Z,{children:[(0,$.jsx)(g.Z,{children:null===(t=e.customerId)||void 0===t?void 0:t.name}),(0,$.jsx)(g.Z,{children:e.sales_person}),(0,$.jsx)(g.Z,{children:new Date(e.invoice_date).toLocaleDateString()}),(0,$.jsxs)(g.Z,{children:["\u20b9",e.final_amount.toFixed(2)]}),(0,$.jsxs)(g.Z,{align:"right",children:[(0,$.jsx)(b.Z,{color:"primary",onClick:function(){var t={_id:e._id,customerId:e.customerId._id,sales_person:e.sales_person,invoice_date:q()(e.invoice_date),delivery_date:q()(e.delivery_date),description:e.description,items:e.items.map((function(e){return{item:e.item._id,quantity:e.quantity,rate:e.rate,tax:e.tax,total:e.total}})),discount:e.discount};A(t),C(!0)},children:(0,$.jsx)(S.Z,{})}),(0,$.jsx)(b.Z,{color:"error",onClick:function(t){return n=t,i=e._id,L(n.currentTarget),void V(i);var n,i},children:(0,$.jsx)(w.Z,{})})]})]},e._id)})):(0,$.jsx)(p.Z,{children:(0,$.jsx)(g.Z,{colSpan:5,align:"center",sx:{py:4},children:(0,$.jsxs)(u.Z,{variant:"body1",children:[" ","No customers found matching ",(0,$.jsxs)("strong",{children:['"',K,'"']}),"."]})})})})]})}),(0,$.jsx)(P.Z,{open:i,onClose:function(){return C(!1)},title:R?"Update Invoice":"Add Invoice",children:(0,$.jsx)(J,{initialData:R||{},onSubmit:ue,onClose:function(){return C(!1)},customers:oe,itemsList:ae})}),(0,$.jsx)(D.Z,{open:O,onClose:ce,onConfirm:function(){me(E),ce()},title:"Delete Invoice?",description:"Are you sure you want to delete this invoice?"}),(0,$.jsx)(_.Z,{open:te,sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},children:(0,$.jsx)(Z.Z,{color:"inherit"})})]})}function te(){return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(i.ql,{children:(0,$.jsx)("title",{children:" Dashboard: Three"})}),(0,$.jsx)(ee,{})]})}}}]);
//# sourceMappingURL=348.d3c87b36.chunk.js.map